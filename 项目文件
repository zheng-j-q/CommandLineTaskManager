Windows命令行任务管理器项目文档

一、需求分析
核心目标：开发一个轻量级命令行工具，实现Windows系统进程的实时监控与管理，支持多线程并发操作以避免界面卡顿。

1、功能需求
（1）实时进程监控：每3秒刷新一次系统进程列表，显示PID、进程名称、内存占用（MB）；
（2）进程终止：支持用户通过PID手动终止指定进程；
（3）多线程并发：分离界面刷新与用户输入线程，避免控制台输出错乱或操作卡顿；

2、非功能需求
（1）兼容性：支持Windows7及以上系统；
（2）性能：进程枚举与内存计算耗时≤1秒，刷新间隔稳定3秒/次；
（3）易用性：命令行交互简洁，支持中文进程名显示，输入PID即可操作；

二、系统设计
整体架构：采用多线程模型，分离“进程监控刷新”与“用户输入处理”两大核心模块，通过互斥锁保证控制台资源同步。

1、模块划分
（1）进程枚举模块：通过Windows API（CreateToolhelp32Snapshot、Process32First/Next）获取系统进程快照，解析PID、名称及内存占用（GetProcessMemoryInfo）；
（2）进程终止模块：通过OpenProcess获取进程句柄，调用TerminateProcess终止指定PID进程；
（3）多线程控制模块：主线程处理用户输入，子线程每3秒刷新进程列表，通过互斥锁（mutex）避免控制台IO冲突；
（4）数据转换模块：实现宽字符（wstring）到UTF-8字符串的转换（wstringToStrong），解决中文进程名乱码问题；

2、关键技术点
（1）多线程同步：使用mutex控制控制台输出，确保刷新界面时阻塞用户输入，输入时阻塞刷新；
（2）Windows API调用：依赖psapi.lib和tlhelp32.h实现进程信息获取与内存计算；
（3）内存管理：严格释放进程句柄（CloseHandle），避免资源泄露；

三、实现细节
开发环境：Windows 10+Visual Studio 2022，C++11标准，静态链接psapi.lib库；

核心代码逻辑：
1、进程信息结构体
struct ProcessInfo{
  
  DWORD pid;    //进程ID
  
  wstring name;   //宽字符进程名（支持中文）
  
  SIZE_T memoryUsage;   //内存占用（字节）

};

2、多线程刷新机制
（1）子线程函数refreshProcesses：循环调用enumProcesses获取进程列表，加锁后清屏并格式化输出（stew控制对齐，内存转换为MB）；
（2）主线程：通过cin读取用户输入PID，加锁确保输入时不被刷新线程中断，输入0时设置isRunning=false终止子线程；

3、进程终止流程
Bool terminateProcess(DWORD pid){
  //请求终止权限
  
  HANDLE hProcess=OpenProcess(PROCESS_TERMINATE,FALSE,pid);
  
  if(hProcess==NULL) return false;
//终止进程
  
  bool sucess=TerminateProcess(hProcess,0);
  
  CloseHandle(hProcess);
  
  return sucess;
  
  };

四、测试验证
测试环境：Windows 10 64位

1、功能测试
测试用例	         |         操作步骤	         |                  预期结果	           |                        实际结果
进程刷新列表	           |   运行程序，观察3秒刷新一次	   |        列表实时更新，PID、名称、内存显示正确	    |     通过
终止存在的进程（如记事本）|	打开记事本，输入其PID并回车	    |     记事本进程关闭，控制台提示“已终止”	           |通过
终止不存在的PID	         | 输入无效PID（如9999）	        |    提示“终止失败”，错误码对应“进程不存在”	       |通过
退出程序	                 | 输入0并回车	                 |     程序正常退出，无资源泄露	                     |通过

2、性能测试
（1）进程枚举耗时：平均0.3秒（枚举约150个进程）；
（2）内存占用：稳定在8-10MB，无内存泄漏；

3、兼容性测试
无。


五、总结：
本项目通过Windows API与多线程技术，实现了命令行环境下的进程监控与管理功能，核心优势在于：
1、轻量高效：无需图形界面，资源占用低，适合后台监控场景；
2、并发安全：互斥锁机制避免多线程控制台冲突，界面刷新与输入响应流畅；
3、可扩展性：可进一步添加进程排序、CPU占用监控等；

六、注意：
本项目是学习C++时边学边做的一个管理器，有诸多问题存在：
1、功能局限性：缺乏进程优先级与资源占用细分、进程筛选与排序能力缺失、高危操作无二次确认；
2、技术实现风险：多线程同步机制的潜在死锁、Windows API调用的兼容性问题、资源泄露隐患；
3、用户体验缺陷：控制台界面交互不友好、错误提示信息模糊、中文显示依赖系统编码；
4、安全与权限问题：缺乏进程权限校验、输入合法性校验缺失；
5、可扩展性瓶颈：模块化程度低、无配置持久化；
